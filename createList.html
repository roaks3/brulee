<head>
    <link rel="stylesheet" type="text/css" href="createList.css" />
    <script type="text/javascript" src="js/jquery-1.7.2.js"></script>
    <script type="text/javascript" src="js/ingredient.js"></script>
    <script type="text/javascript">

        var allRecipes = new Recipes();
        var recipeStore = new ElasticSearchRecipeStore();

        var allCategories = new Categories();
        var shoppingListStore = new ElasticSearchShoppingListStore();

        $(document).ready(function() {

            recipeStore.getAllRecipes(function(recipes) {
                for (var i = 0; i < recipes.size(); i++) {
                    var recipeName = recipes.get(i).getName();
                    $("#recipes").append("<input type='checkbox' name='recipes' value='" + recipeName + "' /> " + recipeName + "<br />");
                }
                allRecipes = recipes;
            });

            shoppingListStore.getAllCategories(function(categories) {
                allCategories = categories;
            });

            $("#createListButton").click(function() {
                // go through each checked check box and accumulate the ingredients of those recipes
                var allIngredients = new Ingredients();
                $("input:checkbox").each(function() {
                    if ($(this).is(":checked")) {
                        var recipeName = $(this).attr("value");
                        var recipe = allRecipes.getByName(recipeName);
                        var ingredients = new Ingredients();
                        ingredients.addAll(recipe.getIngredients());
                        allIngredients.combineAll(ingredients);
                    }
                });

                var leftoverIngredients = new Ingredients();
                leftoverIngredients.addAll(allIngredients);
                for (var i = 0; i < allCategories.size(); i++) {
                    var category = allCategories.get(i);
                    $("#ingredients").append("<b>" + category.getName() + "</b><br />");
                    for (var j = 0; j < category.getItems().length; j++) {
                        var item = category.getItems()[j];
                        var ingredient = allIngredients.getByItem(item);
                        if (ingredient != null) {
                            $("#ingredients").append(ingredient._amount + " - " + ingredient._item + "<br />");
                        }
                        leftoverIngredients.removeByItem(item);
                    }
                }

                $("#ingredients").append("<b>Leftover</b><br />");
                for (var k = 0; k < leftoverIngredients.size(); k++) {
                    var ingredient = leftoverIngredients.get(k);
                    $("#ingredients").append(ingredient._amount + " - " + ingredient._item + "<br />");
                }
            });
        });

    </script>
    
    <title>
        Create Shopping List
    </title>
</head>

<div id="recipes"></div>
<div id="list">
    <button id="createListButton">Create Shopping List</button>
    <div id="ingredients"></div>
</div>
